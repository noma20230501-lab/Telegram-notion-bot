# 텔레그램-노션 부동산 매물 자동 등록 봇

텔레그램에 매물 사진과 정보를 올리면 자동으로 노션 데이터베이스에 등록하는 봇입니다.

## ✨ 주요 기능
- 📷 **여러 장 사진 지원** - 앨범 형태로 여러 장 업로드 가능
- ✏️ **원본 수정 자동 반영** - 텔레그램 메시지 수정 시 노션도 자동 업데이트
- 🔄 **동기화 체크** - `/check` 명령어로 매물 동기화 상태 확인
- 🏷 **깔끔한 UI** - 원본 메시지에 간단히 등록 완료 표시

## 📋 목차
1. [준비물](#준비물)
2. [설치 방법](#설치-방법)
3. [설정 방법](#설정-방법)
4. [사용 방법](#사용-방법)
5. [서버 운영 방법](#서버-운영-방법)
6. [문제 해결](#문제-해결)

---

## 🛠 준비물

### 1. 텔레그램 봇 토큰
1. 텔레그램에서 `@BotFather` 검색
2. `/newbot` 명령어 입력
3. 봇 이름과 username 설정
4. 발급받은 토큰 저장 (예: `1234567890:ABCdefGHIjklMNOpqrsTUVwxyz`)

### 2. 노션 API 토큰
1. https://www.notion.so/my-integrations 접속
2. "+ 새 통합 만들기" 클릭
3. 통합 이름 입력 (예: "부동산봇")
4. "제출" 후 "Internal Integration Token" 복사

### 3. 노션 데이터베이스 ID
1. 노션에서 사용 중인 "부동산 대시보드" 열기
2. 우측 상단 "···" 메뉴 → "연결" → "내 통합"에서 위에서 만든 통합 추가
3. 데이터베이스 URL에서 ID 추출
   - URL 형식: `https://www.notion.so/workspace/DATABASE_ID?v=...`
   - `DATABASE_ID` 부분만 복사 (32자리 영숫자)

---

## 💻 설치 방법

### 방법 1: PC에서 실행 (Windows/Mac/Linux)

1. **Python 설치** (3.8 이상)
   - https://www.python.org/downloads/ 에서 다운로드
   - 설치 시 "Add Python to PATH" 체크

2. **프로그램 다운로드**
   ```bash
   # 폴더 만들기
   mkdir telegram-notion-bot
   cd telegram-notion-bot
   ```

3. **필요한 파일들 저장**
   - `telegram_notion_bot.py`
   - `requirements.txt`
   - `.env.example`

4. **라이브러리 설치**
   ```bash
   pip install -r requirements.txt
   ```

### 방법 2: Google Cloud Run (거의 무료)

나중에 설명하겠습니다.

---

## ⚙️ 설정 방법

1. **환경변수 파일 생성**
   ```bash
   # .env.example을 .env로 복사
   cp .env.example .env
   ```

2. **`.env` 파일 편집**
   ```
   TELEGRAM_BOT_TOKEN=1234567890:ABCdefGHIjklMNOpqrsTUVwxyz
   NOTION_TOKEN=secret_ABC123...
   NOTION_DATABASE_ID=a1b2c3d4e5f6...
   ```

3. **노션 데이터베이스 속성 확인**
   
   봇이 제대로 작동하려면 노션 데이터베이스에 다음 속성들이 있어야 합니다:
   
   | 속성명 | 타입 | 비고 |
   |--------|------|------|
   | 이름 | 제목 | 주소가 들어감 |
   | 층수 | 선택 | 예: "1층", "2층" |
   | 보증금 | 숫자 | |
   | 월세 | 숫자 | |
   | 부가세 여부 | 선택 | "부가세o" 또는 "부가세x" |
   | 관리비(텍스트) | 텍스트 | |
   | 관리비 메모 | 텍스트 | |
   | 권리금 | 숫자 | |
   | 건축물용도 | 선택 | |
   | 계약면적(m²) | 숫자 | |
   | 전용면적(m²) | 숫자 | |
   | 계약/전용(평) | 텍스트 | 자동 계산됨 |
   | 주차 | 선택 | "가능" 또는 "불가" |
   | 주차 메모 | 텍스트 | |
   | 화장실 수 | 숫자 | |
   | 화장실 위치 | 선택 | "내부" 또는 "외부" |
   | 방향 | 선택 | 남향, 북향 등 |
   | 등기 | 선택 | "있음" 또는 "없음" |
   | 위반건축물 | 선택 | "위반건축물O" 또는 "위반건축물X" |
   | 대표 연락처 | 전화번호 | |
   | 연락처 메모 | 텍스트 | |
   | 등록 날짜 | 날짜 | |

---

## 📱 사용 방법

### 1. 봇 실행
```bash
python telegram_notion_bot.py
```

실행되면:
```
🤖 봇이 시작되었습니다...
텔레그램에서 사진과 매물 정보를 전송하면 자동으로 노션에 등록됩니다.
📷 여러 장 사진 앨범도 지원됩니다!
✏️ 원본 메시지를 수정하면 노션에도 자동으로 반영됩니다!
/check 명령어로 동기화 상태를 확인할 수 있습니다.
```

### 2. 텔레그램 채널 설정 (중요!)
**봇이 메시지를 수정하려면 채널 관리자 권한이 필요합니다:**

1. 채널 설정 → 관리자 → 봇 추가
2. 다음 권한 부여:
   - ✅ 메시지 게시하기
   - ✅ 메시지 수정하기
   - ✅ 메시지 삭제하기

### 3. 매물 등록

a. 채널에 사진 선택 후 **캡션(설명)** 에 매물 정보 입력:
```
중구 봉산동 168-20 1층2222
1. 1000/55 부가세x
2. 관리비 실비정산
3. 1900 (집포2000, 집제3000, 권리금 컴퓨터포함)
4. 제2종근린생활시설 일반음식점 계약면적 48m2 전용면적 48m2  15평
5. 주차불가 / 내부화장실1개
6. 북서향
7. 위반x / 등기o
8. 양도인 010-6739-7593
임대인 123456789
```

b. 전송하면 자동으로:
- 노션에 등록
- 원본 메시지에 이렇게 추가됩니다:
```
━━━━━━━━━━━━━━
✅ 노션 등록완료
🔗 https://notion.so/xxxxx
```

### 4. 매물 수정 (NEW! ✨)

**원본 메시지를 직접 수정하면 노션에도 자동 반영됩니다!**

예시:
1. 월세가 55만원 → 65만원으로 변경
2. 원본 메시지에서 `1. 1000/55` → `1. 1000/65` 수정
3. 자동으로 노션 업데이트 + 수정 이력 추가:
```
━━━━━━━━━━━━━━
✅ 노션 등록완료
🔗 https://notion.so/xxxxx
🔄 02/11 14:30 월세55→65
```

### 5. 동기화 상태 확인

채널에서 `/check` 명령어 입력:
```
📊 매물 동기화 체크 결과

📱 텔레그램 매물 (봇 실행 후): 25개
📝 노션 매물 (전체): 25개

✅ 동기화율: 100.0%
✅ 봇 실행 후 등록된 모든 매물이 동기화되어 있습니다!
```

### 6. 결과 확인
- 노션 데이터베이스에서 새 카드 확인
- 매물 정보, 사진 모두 자동 정리됨

---

## 🌐 서버 운영 방법

봇을 24시간 돌리려면 항상 켜져있는 컴퓨터나 서버가 필요합니다.

### 옵션 1: PC 켜놓기 (가장 간단)
- 집에 PC 하나 24시간 켜놓고 봇 실행
- 장점: 무료, 쉬움
- 단점: 전기세, 소음

### 옵션 2: 라즈베리파이 (추천)
- 라즈베리파이 구매 (5~10만원)
- 전기도 거의 안 먹고 조용함
- 설정은 PC와 동일

### 옵션 3: Google Cloud Run (거의 무료)
- 사용한 만큼만 과금 (이 용도론 무료)
- 24시간 관리 불필요
- 설정이 조금 복잡 (필요하면 가이드 드릴게요)

### 옵션 4: 유료 클라우드
- Railway: $5/월
- Render: $7/월
- 안정적이지만 비용 발생

---

## 🔧 문제 해결

### 봇이 응답하지 않아요
1. 봇이 실행 중인지 확인
2. 텔레그램 토큰이 맞는지 확인
3. 사진 + 캡션을 함께 보냈는지 확인

### 노션에 등록이 안 돼요
1. 노션 통합을 데이터베이스에 연결했는지 확인
2. DATABASE_ID가 맞는지 확인
3. 데이터베이스 속성 이름이 정확한지 확인

### 일부 정보가 누락돼요
1. 입력 형식이 정확한지 확인
2. 숫자 뒤에 공백이 있는지 확인
3. "m2" 표기가 정확한지 확인 (m2, ㎡ 둘 다 가능)

### 평수 계산이 안 돼요
- 면적을 "전용 33.05m2" 형식으로 입력했는지 확인
- 숫자와 m2 사이 공백 확인

---

## 💡 팁

- **매물 사진 여러 장 업로드**: 앨범으로 선택해서 한 번에 업로드 가능
- **특이사항**: 자유롭게 여러 줄 작성 가능
- **권리금**: 없으면 "무권리" 또는 "0" 입력
- **관리비**: "실비", "포함", "10만원" 등 자유롭게
- **수정**: 원본 메시지만 수정하면 노션도 자동 반영!
- **구분선 주의**: 봇이 추가한 `━━━━━━━━━━━━━━` 아래는 수정하지 마세요

---

## 🆕 업데이트 내역

### v2.0 (2026-02-11)
- ✨ 원본 메시지 수정 시 노션 자동 반영
- ✨ `/check` 명령어로 동기화 상태 확인
- 🎨 답장 메시지 제거 → 깔끔한 채널 관리
- 📝 수정 이력 한 줄로 간략하게 표시

### v1.0 (이전)
- 기본 매물 등록 기능
- 여러 장 사진 지원
- 답장으로 수정 기능

---

문제가 있거나 기능 추가가 필요하시면 말씀해주세요!
